---
title: "EXP 2 (Kiss, Pieper, Börner 2023)"
output:
  html_document: default
  pdf_document: default
date: "15.02.2023"
---

### Analysis of experimental study on object-oriented and subject-oriented modifiers

This document provides the analysis for the experimental study on object-oriented and subject-oriented event-internal modifiers with alternating wh-indefinites and full indefinite NPs discussed in Kiss, Pieper, Börner (2023) (EXP 2).

#### Read in required libraries

```{r libraries, warning=FALSE, message=FALSE}
library(lme4)
library(tidyverse)
library(emmeans) 
library(kableExtra)
library(brms)  

show(version)
```

### Read in data

We provide a summary of the data. The test items contained in the data set are pretty-printed below.

```{r read-in data}
data <-
  read.csv("../Data/EXP_2_test.csv", 
           fileEncoding = "UTF-8", stringsAsFactors = TRUE) %>%
  mutate(TYPE = relevel(TYPE, ref = "INSTR"),
         OBJform = relevel(OBJform, ref="NP"))

summary(subset(data, select = -c(OPTION_0_ITEM, OPTION_1_ITEM, OPTION_0_KEY_CONDITION, 
                                 OPTION_1_KEY_CONDITION, date_time_begin, date_time_end)))

```

### Test items

The following table provides the 24 minimal pairs of test items used in EXP 2. The experimental data have been judged by 31 participants after filtering unattentive participants according to Pieper et al. (2023).  

```{r read in test items for presentation, echo = FALSE, message = FALSE}

data.sum <- data %>%
  select(ITEM_ID, TYPE, OPTION_0_ITEM, OPTION_1_ITEM) %>%
  group_by(ITEM_ID, TYPE, OPTION_0_ITEM, OPTION_1_ITEM) %>%
  summarize(count = n())

colnames(data.sum)[1:4] <- c("Test Item Pair", "Adverbial Type", "PP > OBJ", "OBJ > PP")

kbl(data.sum[,1:4]) %>% kable_styling()

```

#### Empirical distribution of choices

The following plot shows the distribution of empirical choices of the serializations (`PP > OBJ`, `OBJ > PP`) across the two types of adverbials (`INSTR`, `COM(O)`). 

##### Object-oriented comitatives

For `COM(O)`, we notice a strong preference for the serialization `OBJ > PP`, which is in line with previous analyses and the results of `EXP1`. We also observe some differences with regard to the two different types of realization of the object (wh indefinite vs. full indefinite), and in particular an empirical preference for `PP > OBJ ` if the object is a wh indefinite, but this might be due to chance (see the model below). 

##### Instrumentals

For `INSTR`, we also observe an empirical preference for `OBJ > PP`, but a less pronounced one. What we also observe is that there is less variation between the two forms of the object (wh indefinite vs. full indefinite). While there is a slight preference for `PP > OBJ` for wh indefinites, the model indicates that it is not significant (see below).


```{r empirical distribution, message = FALSE}

summary <- 
  data %>% 
  group_by(TYPE, OBJform, ANSWER) %>% 
  summarise(count=n())

summary

ggplot(summary, aes(x = ANSWER, y = count, fill = OBJform)) +
  geom_bar(stat = "identity", position = "dodge") + 
  labs(x = "Serialization", y = "Frequency of serialization") +
  scale_fill_manual(name = "Form of obj.", values = c("NP" = "steelblue","wh" = "grey80"),
                    labels = c("NP (indef.)", "wh indefinite")) + 
  facet_wrap(~TYPE)

```

### Random slope model for full data set

It is not only the form of the object (`OBJform`)that does not receive a significant coefficient, but the coefficient for the type of adverbial (`TYPE`) also borders the threshold of p < 0.05. Given this situation, we have chosen a rather simple random structure with a random intercept for the items (`ITEM_ID`), which do not vary across subjects anyway, and a random slope for participants (intercept + `TYPE`). 


```{r model}
model_1 <- glmer(ANSWER ~ TYPE + OBJform + 
                     (1 + TYPE | workerId) + 
                     (1|ITEM_ID), data = data, family = "binomial")

summary(model_1)

results_1 <- emmeans(model_1, pairwise~TYPE + OBJform, type = "response")

results_1$emmeans

```

```{r model without OBJform}

data <- 
  data %>%
  mutate(TYPE = relevel(TYPE, ref = "COM(O)"))

model_2 <- glmer(ANSWER ~ TYPE + 
                     (1 + TYPE | workerId) + 
                     (1|ITEM_ID), data = data, family = "binomial")

summary(model_2)

results_2 <- emmeans(model_2, "TYPE" , type = "response")

results_2
```

The following Bayesian model is included to provide more information about the likelihood distribution of the predictors. The Bayesian model shows that even for the intercept, we find a small percentage of samples with effect sizes in the region of practical equivalence (ROPE). Hence, the hypothesis that the reference values show no effect can neither be rejected nor confirmed. The number of samples contained in the ROPE, however, is small (< 6 %), particularly if compared to the number of samples in the ROPE for `OBJform == wh`.   

```{r Bayesian model}

model_3 <- brm(ANSWER ~ TYPE + OBJform + (1 + TYPE | workerId) + (1|ITEM_ID), 
                  data = data, 
                  bernoulli(link = "logit"),
                  warmup = 1000,
                  iter = 2000,
                  chains = 4, 
                  cores = parallel::detectCores())

model_3

bayestestR::equivalence_test(model_3)

plot(model_3, variable = "^b_", regex = TRUE)


```

